<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Todo playground</title>

    <script type="module" src="/db.js"></script>
  </head>
  <body>
    <h1>Todo playground</h1>
    <form action="/todos" method="POST">
      <input type="text" name="title" />
      <input type="checkbox" name="completed" />
      <button type="submit">Create</button>
    </form>

    <div id="todos"></div>

    <script type="module">
      import * as db from "/db.js";

      window.addEventListener("load", async () => {
        const todos = await db.getTodos();
        renderTodos(todos);
      });

      function renderTodos(todos) {
        const todosElement = document.getElementById("todos");
        for (const todo of todos) {
          const todoElement = document.createElement("li");
          const updateFormElement = document.createElement("form");
          updateFormElement.action = `/todos/${todo.id}`;
          updateFormElement.method = "POST";

          const titleElement = document.createElement("input");
          titleElement.type = "text";
          titleElement.name = "title";
          titleElement.value = todo.title;
          updateFormElement.appendChild(titleElement);

          const completedElement = document.createElement("input");
          completedElement.type = "checkbox";
          completedElement.name = "completed";
          completedElement.checked = todo.completed;
          updateFormElement.appendChild(completedElement);

          const updateButtonElement = document.createElement("button");
          updateButtonElement.type = "submit";
          updateButtonElement.innerText = "Update";
          updateFormElement.appendChild(updateButtonElement);
          todoElement.appendChild(updateFormElement);

          const deleteFormElement = document.createElement("form");
          deleteFormElement.action = `/todos/${todo.id}/delete`;
          deleteFormElement.method = "POST";

          const deleteButtonElement = document.createElement("button");
          deleteButtonElement.type = "submit";
          deleteButtonElement.innerText = "Delete";
          deleteFormElement.appendChild(deleteButtonElement);

          todoElement.appendChild(deleteFormElement);
          todosElement.appendChild(todoElement);
        }
      }
    </script>
  </body>
</html>
